<!DOCTYPE html>
<html>
<head>
    <title>API拦截调试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .button {
            padding: 10px 20px;
            margin: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>API拦截调试页面</h1>
    <p>这个页面用于测试API拦截功能。</p>
    
    <div>
        <button class="button" onclick="testFetch()">测试 Fetch</button>
        <button class="button" onclick="testXHR()">测试 XHR</button>
        <button class="button" onclick="clearLog()">清除日志</button>
    </div>
    
    <div class="log" id="log">等待测试...</div>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
        }
        
        async function testFetch() {
            log('开始Fetch测试...');
            try {
                console.log('About to make fetch request');
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Test-Header': 'fetch-test'
                    }
                });
                console.log('Fetch response received:', response.status);
                const data = await response.json();
                log(`Fetch响应: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Fetch错误: ${error.message}`);
                console.error('Fetch error:', error);
            }
        }
        
        function testXHR() {
            log('开始XHR测试...');
            const xhr = new XMLHttpRequest();
            console.log('Creating XHR request');
            
            xhr.open('POST', 'https://jsonplaceholder.typicode.com/posts', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('X-Test-Header', 'xhr-test');
            
            xhr.onload = function() {
                console.log('XHR onload triggered:', this.status);
                if (this.status >= 200 && this.status < 300) {
                    log(`XHR响应 (${this.status}): ${this.responseText}`);
                } else {
                    log(`XHR错误: ${this.status} ${this.statusText}`);
                }
            };
            
            xhr.onerror = function() {
                log('XHR网络错误');
                console.error('XHR network error');
            };
            
            console.log('Sending XHR request');
            xhr.send(JSON.stringify({
                title: 'Test Post',
                body: 'This is a test post via XHR',
                userId: 1
            }));
        }
        
        // 页面加载完成
        log('调试页面加载完成，可以开始测试');
        console.log('Debug page loaded');
    </script>
</body>
</html>